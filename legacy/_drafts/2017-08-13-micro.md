---
layout: post
title: "Building Microservices(2017), Sam Newman"
description: ""
date: 2017-08-13
tags: []
categories: 'Dev'
---

필자는 컨퍼런스에서 발표할 때 '자니차게 큰 시스템을 관리하는 중이며 이를 작게 세분화하기를원하는 사람'이 있는지 매번 물어본다고 한다. 청중 거의 모든사람이 손을 든다고 한다. 내가 청중이였다면 두손을 번쩍 들었을 것이다. 회사 업무에서 내가 책임지고있는 시스템이 그저 '웹페이지'라는 속성 아래 지나치게 비대하고 복잡한 상태다. 시스템의 주된 부분인 웹 어플리케이션 이외에도 서비스 랜딩페이지, 모바일 광고 페이지, 서비스 이용 신청페이지, 모바일 관련 웹페이지 등, 다양한 서비스들이 하나의 monolithic application에 담겨져 있다. 더구나 이 모놀리틱 서비스의 호스트에는 legacy version api 어플리케이션도 돌아가고 있다.

 나는 경험이 부족하기 때문에 '복잡하다'라는 나의 말이 얼마나 객관성을 갖는지 모른다. 따라서 비교적 간단한 시스템을 복잡하게 생각하므로써 오버엔지니어링 할 수있고, 반대로 엄청 복잡한 서비스에대한 문제인식을 하지 못해 큰 비용을 치를 수 있다고 생각한다. 사실상 이러한 아키텍쳐는 단순 기술의 문제가아닌 회사의 비지니스 상황에 따라서도 얼마든지 달리 인식될 수 있다고 생각한다. 오로지 '기술적'인 관점으로만 접근하다보면 비효율적으로 문제를 풀 떄가 많을 수 있다.

## 갈무리

---

## 1. 마이크로서비스

- 마이크로 서비스란 작고 자율적으로 협업하는 서비스를 의미한다

- "얼마나 작아야 작은 것인가?" (...) 존 이브는 경험적으로 '마이크로서비스란 2주 안에 재작성될 수 있는 것'이라고 특정한다.

- 기술 이기종성
    - 다수의 협업 서비스로 구성된 시스템에서는 각 서비스가 다른 기술을 사용하도록 결정할 수 있다. 이는 결국 최소한의 공통점만을 지닌 표준화된, 만능의 접근 방식을 선택하기보다 각 작업에 적합한 도구를 선택하게 해준다.
    - 시스템에 특정 부분의 성능을 높이려 할 때, 요구되는 성능 수준을 만족하는 데 유리한 다른 기술 스택을 고려해야 할 수도 있고 변환할 데이터를 어떻게 저장할지 결정해야 할 수도 있다.
- 회복성
    - 회복공학의 핵심은 격벅이다. 즉, 한 시스템의 컴포넌트에 장애가 발생하더라도 그 장애가 전파되지 않는다면 해당 문제를 격리하고 나머지 시스템을 계속 작동시킬 수 있다.
    - 하지만 주의해야할 점도 있다. (...) 분산 시스템이 마주한 새로운 장애 요인들을 이해해야 한다.
- 확장성
    - 모놀리틱 서비스에서는 항상 모든 것을 함께 확장해야 한다. 만약 전체 시스템에서 작은 한 부분만 서은ㅇ이 떨어지는데, 해당 동작이 거대한 모놀리틱 에플리케이션에 묶여 있다면 전체를 한 덩어리처럼 확장해야 한다.
- 배포 용이성
    - 한 줄만 수정하더라도 해당 변경을 릴리스하기 위해 전체 에블리케이션을 배포해야 한다. 이는 막대한 영향을 끼치는 아주 위험한 배포가 될 수 있다.
    - 마이크로서비스를 이용하면 하나의 서비스만 변경할 수 있고, 나머지 시스템과 독립적으로 배포할 수 있다. 코드를 더 신속히 배포할 수 있고, 문제가 발생하더라도 손쉽게 개별 서비스만 롤백함으로써 해당 문제를 격리할 수 있다.
- 조직 부합성
    - 최적의 팀 크기와 생산성을 위해 하나의 코드베이스에서 일하는 인원을 최소화 할 수 있다. 그리고 같은 곳에 있는 서비스 소유권을 팀 간에 이전할 수도 있다.
- 대체 가능성을 위한 최적화
    - 각 서비스가 작은 크기로 이루어져 있다면 더 나은 구현으로 교체하는 비용을 줄일 수 있으며, 심지어 삭제도 쉽게 할 수 있다.
- 은총알은 없다
    - 마이크로시븟가 공짜도 은총알도 아니며, 황금 망치로 오이노디는 일은 없어야 한다고 강조한다. 마이크로서비스는 분산 시스템과 연관된 모든 종류의 복잡성을 내포하고 있으며, 이 책 전반에 걸쳐 설명한 분산시스템을 적절히 다루는 방법을 익히더라도 여전히 어려운 것은 사실이다.

## 2. 진화적 아키텍트

- 시스템 기술 비전의 주요 책임자가 되는 것과 여러분이 그 비전을 싱행하게 된다는 것은 기술의 결정에 관한 문제가 아닌 여러분과 그 일을 할 사람들에 관한 문제와 직결된다. 기술 리더의 역할은 사람들이 스스로 비전을 이해하도록 그들의 성장을 돕고, 비전을 결정하고 구현하는 데 적극적으로 참여할 수 있도록 만드는 것이다.

- 주의 사람들의 경력 성장을 도와주는 다양한 방법은 이 책의 범위를 벗어나지만 마이크로서비스 아키텍처와 관련 있는 단면도 존재한다. 거대한 모놀리식 시스템에서는 사람들이 성장하고 무엇인가를 소유할 기회가 거의 없다. 바면 마이크로서비스에서 우리는 독립적 수명주기를 가진 수많은 자율적인 코드베이스를 가진다. 사람들이 더 많은 책무를 맡기 전에 개별 서비스의 소유권을 부여함으로써 그들을 성장시키는 것은 그들 자신의 경력 목표를 성취하도록 돕는 훌륭한 방법일 뿐만 아니라 다른 담당자들의 짐도 덜어준다.

- 필자는 훌륭한 소프트웨어는 훌륭한 사람에 의해 만들어지는 것이라고 굳게 믿고 있다. 만약 여러분이 이 방정식에서 기술적인 측면만 걱정한다면 전체 그림의 절반 이상을 놓치게 된다.

- 아키텍트의 핵심 책무를 정리했다
    - 비전: 명료하게 소통되고, 시스템이 고객과 조직의 요구 사항을 웇ㅇ족하도록 돕는 기술 비전이 있는지 확인하라
    - 공감: 고객과 동료에 대한 여러분 결정의 파급력을 이해해라
    - 협업: 비전을 정의하고, 다듬고, 실행하기 위해 가능한 많은 동료와 협업하라.
    - 적응성: 기술 비전이 고객과 조직이 요구하는 것을 반영하는지 확인하라.
    - 자율성: 여러분 팀의 표준화와 자율성 사이에서 올바른 균형을 찾아내라.
    - 거버넌스: 시스템이 기술 비전에 맞게 구현되고 있는지 확인하라.

## 3. 서비스 모델링하기

- 느슨한 결합
    - 서비스가 서로 느슨히 결합되어 있으면 하나의 서비스가 변결될 때 다른 서비스가 변경되는 일이 없다.

- 강한 응집력
    - 서로 연간된 행위는 한데 모아두고, 그렇지 않은 것은 다른곳에 두고 싶어 한다. 그 이유는 무엇일까? 특정 행위를 변경하고자 할 때는 한곳에서 가능한 신속하게 릴리즈할 수 있기를 원한다.

- 성급한 분해
    - 시스템을 마이크로서비스로 성급하게 분리하면 막대한 비용이 소요될 수 있다. 특히 도메인에 대한 경험이 없다면 더더욱 그렇다. 여러모로 기존 코드베이슬르 마이크로 서비스로 분해하는 것이 처음부터 마이크로서비스로 가는 것보다 훨씬 쉽다.

## 4. 통합

## 8. 모니터링

- 최소한의 필수 사항으로 응답시간을 추적하고 그다음에 에러율을 추적하라. 그리고 나서 애플리케이션 레벨 측정 지표에대해 작업해라.
- 모든 하위 응답에 상태를 추적하라. 최소한 하위 호출의 응답시간을 포함하고 할 수 있다면 에러율도 추적하라.
- 측정 지표가 수집될 방식과 저장소를 표준화하라
- 가능하면 표준 저장소와 포멧으로 로깅하라. 모든 서비스가 다른 형식을 사용한다면 취합은 매우 어렵다.
- 불량 프로세스를 추적하고 용량 계획을 수행할 수 있도록 하부 운영 체제를 모니터링하라
